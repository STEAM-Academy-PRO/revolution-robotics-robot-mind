[![Build Status](https://travis-ci.org/RevolutionRobotics/RevvyFirmware.svg?branch=master)](https://travis-ci.org/RevolutionRobotics/RevvyFirmware)

RevvyFirmware
==============

This repository contains the application code running on the ATSAMD51P19A microcontroller on the Revolution Robotics Challenge Kit's control board.
This firmware was built using CGlue, an in-house developed firmware architecture and toolkit. Most of the custom-developed firmware is organized into
software components that are connected by a runtime layer generated by CGlue. The component models are individually described in the components' folders,
the port connections are configured in the `project.json` file in the root folder.
Because CGlue is missing some features, some of the software components contain manual modifications to the generated component structure or runtime layer.
An example for this is the communication layer: currently, it is not possible to describe, which command IDs belong to which command handler functions,
so these connections are done in a manually written source file.
One of the end goals of the CGlue-based application was to create software components that are independent of the underlying hardware and so they are
portable and testable. Due to time and resource constraints, this goal has not been met.

The other substantial part of the firmware is the code provided by Atmel/Microchip. Some of their SDK is used as-is, but other parts, for example the
SERCOM codes have been modified, replaced or removed from the package.

The application code contains error logging. Log entries are made on hard fault exceptions and assert failures (in debug configuration). To read and clear
log entries, you can use the provided tools in the RevvyFirmware repository.

[Documentation](../docs/mcu/setup.md)

Developing with CGlue
--------------------

* Create a new software component: `cglue --new-component ComponentName`
* Update generated component code based on modification of the component model: `cglue --update-component ComponentName [--cleanup]`
* Generate runtime based on the project.json configuration: `cglue --generate --cglue-output=rrrc/generated_runtime [--cleanup]`
  The generated files are: `rrrc/generated_runtime.h` and `rrrc/generated_runtime.c`
* Generate makefile for compilation: `python -m tools.generate_makefile [--cleanup]`

When using the provided VS Code tasks, runtime and makefile generation is done automatically during the build process.
